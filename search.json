[{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/Introduction.html","id":"rcollectl-workflow","dir":"Articles","previous_headings":"","what":"Rcollectl Workflow","title":"Introducton to RcollectlWorkflowh5ad","text":"vignettes package follows single-cell analysis workflow (workflow chapters “Orchestrating Single-Cell Analysis Bioconductor” book) analyze h5ad file cellxgene dataset tracks computing resources usage R package Rcollectl. Two workflows Rcollectlworkflowh5ad workflow_h5ad_DelayedArray_parameters available Dockstore, also set Terra workspace, bioconductor-rpci-yubo/Rcollectlworkflowh5ad. Vignette terra_data_import.Rmd includes R code importing data h5ad file(s) Terra workspace run workflows. performance_summary.Rmd provides performance summary running two workflows, functions summary_result_dataset() summary_result() generate csv files needed vignette.","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/performance_summary.html","id":"time-and-resources-spent-in-the-workflow","dir":"Articles","previous_headings":"","what":"Time and resources spent in the workflow","title":"Performance Summary","text":"CPU usage, memory usage running time compared DelayedArray vs dgcMatrix medium vs large size file. 240 GB memory 3 cpus used. Medium: number cells: 94256, large: number cells: 168860 running workflow Rcollectlworkflowh5ad Terra workspace, submission ids used input generate three csv files CPU_mean.csv, MEM_mean.csv Time.csv R code . Three csv files generated default R work directory. Read saved version result R. CPU mean Memory max Time reading H5AD file SingleCellExperiment object assays loaded DelayedArray, large data file requires high memory usage step variance modeling differential expression, two steps also takes much longer time complete.","code":"## generate comparison csv files library(AnVIL) library(Rcollectl) library(Rcollectlworkflowh5ad) avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") ## [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\" inputTribble <- tribble(   ~name, ~submissionId,   \"dgCMatrix_medium\", \"17efa80e-3ef1-429d-8359-58c7cd653310\",   \"DA_medium\", \"2f0cc8ee-ae53-44e6-a6c0-31e7089f0d42\",   \"dgCMatrix_large\", \"c3c147eb-2ff8-4cf0-ba55-5708fa9c0ae5\",   \"DA_large\", \"8be18771-f06d-4256-ac13-6566a3053f14\" ) summary_result_dataset(inputTribble) CPU_mean <-    system.file(package = \"Rcollectlworkflowh5ad\", \"extdata\", \"CPU_mean.csv\") read.csv(CPU_mean) ##                          X dgCMatrix_medium DA_medium dgCMatrix_large  DA_large ## 1         data preparation         3.368421  3.000000        3.258303  3.000000 ## 2          quality control         4.017857  5.121212        4.104396  6.312500 ## 3        variance modeling         4.368421  6.887931        4.070175  7.390212 ## 4         data integration         8.953125  5.442857        6.228723  3.912607 ## 5 dimensionality reduction        10.038462  9.082192       24.943820 24.415094 ## 6               clustering         3.264151  3.244444        3.192857  3.266667 ## 7  differential expression         5.950000  7.115702        5.500000  7.218750 MEM_mean <-    system.file(package = \"Rcollectlworkflowh5ad\", \"extdata\", \"MEM_mean.csv\") read.csv(MEM_mean) ##                          X dgCMatrix_medium DA_medium dgCMatrix_large  DA_large ## 1         data preparation         10.23072   8.65756        38.13027  12.80643 ## 2          quality control         12.10335  10.43408        43.50213  18.44732 ## 3        variance modeling         13.40427  19.08244        57.82386 111.87739 ## 4         data integration         14.06773  12.24617        64.10852  37.49262 ## 5 dimensionality reduction         13.28435  10.27456        53.89990  15.30035 ## 6               clustering         13.63489  10.13576        59.17014  15.19234 ## 7  differential expression         15.74506  19.40595        76.12158 116.01977 Time <-    system.file(package = \"Rcollectlworkflowh5ad\", \"extdata\", \"Time.csv\") read.csv(Time) ##                          X dgCMatrix_medium DA_medium dgCMatrix_large DA_large ## 1         data preparation          0:00:38   0:00:16         0:04:31  0:00:22 ## 2          quality control          0:00:56   0:01:05         0:03:01  0:03:28 ## 3        variance modeling          0:00:17   0:01:55         0:00:56  0:37:47 ## 4         data integration          0:01:04   0:02:19         0:03:07  0:11:37 ## 5 dimensionality reduction          0:01:17   0:01:12         0:02:57  0:02:38 ## 6               clustering          0:00:52   0:00:44         0:02:19  0:01:13 ## 7  differential expression          0:00:18   0:01:59         0:01:05  0:39:59"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/performance_summary.html","id":"workflow-running-performance-of-delayedarray-with-different-parameters-setup","dir":"Articles","previous_headings":"","what":"Workflow running performance of DelayedArray with different parameters setup","title":"Performance Summary","text":"reading H5AD file SingleCellExperiment object assays loaded DelayedArray, set auto block size number cpus impact workflow running performance. Running time, memory usage cpu usage evaluated , workflow step variance modeling (function scran::modelGeneVarByPoisson) taken example. running workflow workflow_h5ad_DelayedArray_parameters Terra workspace, submission ids used input generate six csv files ended autoBlockSize.csv six ended cpu.csv, combined one file different autoBlockSize one different cpus using R code . Two csv files generated default R work directory every submission id, one ended _autoBlockSize.csv, _cpu.csv. Read saved version result R. Results file url: https://datasets.cellxgene.cziscience.com/0c6f2c74-8d27-4c1f-b63a-a766bc9f9490.h5a , cell count: 19361 autoBlockSize Number cpus Results file url: https://datasets.cellxgene.cziscience.com/e0102be9-1756-46a9-aed1-4b2f03aade3c.h5a , cell count: 94256 autoBlockSize Number cpus autoBlockSize increases, running time reduces, memory CPU usage stay . given memory, couple CPUs reduces running, CPUs increase running time well memory CPU usage.","code":"# autoBlockSize library(Rcollectl) times_delayed_block_size <- lapply(67108864L * 2L^(0:5), function(i) {     gc()     setAutoBlockSize(i)     bpp <- SerialParam()     system.time({         id <- cl_start(paste0(\"AutoBlockSize_\", i))         dec_delay <- modelGeneVarByPoisson(             sce_delay, block=sce_delay$sample, BPPARAM=bpp         )         cl_stop(id)     }) })  # cpu setAutoBlockSize(.Machine$integer.max) times_delayed <- lapply(1:5 * 2L, function(i) {     message(i)     bpp <- MulticoreParam(i)     system.time({         id <- cl_start(paste0(\"cpu_\", i))         dec_delay <- modelGeneVarByPoisson(             sce_delay, block=sce_delay$sample, BPPARAM=bpp         )         cl_stop(id)     }) }) ## generate csv files for different autoBlockSize and cpu library(AnVIL) library(Rcollectl) library(Rcollectlworkflowh5ad) avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") ## [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\" submissionId <- \"8ca42a70-d2e9-421f-9f51-f42601348a82\" summary_result(submissionId)  submissionId <- \"35280de1-42d8-492b-aa8c-5feff984bffa\" summary_result(submissionId) autoBlockSize <-    system.file(package = \"Rcollectlworkflowh5ad\",                \"extdata\",                \"8ca42a70-d2e9-421f-9f51-f42601348a82_autoBlockSize.csv\") read.csv(autoBlockSize) ##   X autoBlockSize elapsed  MEM_max MEM_mean CPU_max CPU_mean ## 1 1      67108864 0:13:54 11.19269 10.47111      18 5.549701 ## 2 2     134217728 0:07:03 10.99466 10.35032      15 5.530660 ## 3 3     268435456 0:03:31 11.36526 10.39782      19 5.518868 ## 4 4     536870912 0:01:51 11.07811 10.34006      14 5.589286 ## 5 5    1073741824 0:01:11 10.76927 10.13873      15 5.472222 ## 6 6    2147483648 0:00:47 10.81758 10.05447      15 5.708333 cpu <-    system.file(package = \"Rcollectlworkflowh5ad\",                \"extdata\",                \"8ca42a70-d2e9-421f-9f51-f42601348a82_cpu.csv\") read.csv(cpu) ##   X ncpus elapsed  MEM_max MEM_mean CPU_max CPU_mean ## 1 1     2 0:00:34 14.53894 11.93556      14  7.80000 ## 2 2     4 0:00:18 19.87384 15.91087      20 19.36842 ## 3 3     6 0:00:20 26.00522 19.97337      38 28.85714 ## 4 4     8 0:00:20 31.49530 23.94961      44 38.04762 ## 5 5    10 0:00:21 36.75488 26.62264      55 46.40909 ## 6 6    12 0:00:25 41.35259 27.48460      70 49.61538 autoBlockSize <-    system.file(package = \"Rcollectlworkflowh5ad\",                \"extdata\",                \"35280de1-42d8-492b-aa8c-5feff984bffa_autoBlockSize.csv\") read.csv(autoBlockSize) ##   X autoBlockSize elapsed  MEM_max MEM_mean CPU_max CPU_mean ## 1 1      67108864 1:56:59 13.72654 12.41776      20 5.553989 ## 2 2     134217728 0:59:31 13.70392 12.15967      19 5.558511 ## 3 3     268435456 0:29:28 13.63512 12.10278      19 5.551724 ## 4 4     536870912 0:14:43 13.05975 12.09455      18 5.542986 ## 5 5    1073741824 0:07:45 12.81247 12.04575      19 5.564378 ## 6 6    2147483648 0:04:14 13.30075 12.17355      15 5.537255 cpu <-    system.file(package = \"Rcollectlworkflowh5ad\",                \"extdata\",                \"35280de1-42d8-492b-aa8c-5feff984bffa_cpu.csv\") read.csv(cpu) ##   X ncpus elapsed  MEM_max MEM_mean CPU_max CPU_mean ## 1 1     2 0:02:17 18.90832 16.46246      19 10.28261 ## 2 2     4 0:01:16 29.01726 22.16929      30 18.89610 ## 3 3     6 0:01:19 28.74403 21.40785      30 18.88750 ## 4 4     8 0:00:54 44.75895 30.05735      50 33.12727 ## 5 5    10 0:00:53 54.71353 35.05400      60 41.22222 ## 6 6    12 0:01:01 62.60962 37.23788      70 45.17742"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/performance_summary.html","id":"r-session-information","dir":"Articles","previous_headings":"","what":"R session information","title":"Performance Summary","text":"","code":"## ─ Session info ─────────────────────────────────────────────────────────────────────────────────────────────────────── ##  setting  value ##  version  R version 4.3.2 (2023-10-31) ##  os       Ubuntu 22.04.3 LTS ##  system   x86_64, linux-gnu ##  ui       X11 ##  language en ##  collate  C.UTF-8 ##  ctype    C.UTF-8 ##  tz       UTC ##  date     2023-11-07 ##  pandoc   2.19.2 @ /usr/bin/ (via rmarkdown) ##  ## ─ Packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────── ##  package               * version date (UTC) lib source ##  AnVIL                 * 1.12.4  2023-08-17 [2] Bioconductor ##  bslib                   0.5.1   2023-08-11 [2] RSPM ##  cachem                  1.0.8   2023-05-01 [2] RSPM ##  cellxgenedp             1.4.1   2023-08-25 [2] Bioconductor ##  cli                     3.6.1   2023-03-23 [2] RSPM ##  colorspace              2.1-0   2023-01-23 [2] RSPM ##  curl                    5.1.0   2023-10-02 [2] RSPM ##  desc                    1.4.2   2022-09-08 [2] RSPM ##  digest                  0.6.33  2023-07-07 [2] RSPM ##  dplyr                 * 1.1.3   2023-09-03 [2] RSPM ##  DT                      0.30    2023-10-05 [2] RSPM ##  ellipsis                0.3.2   2021-04-29 [2] RSPM ##  evaluate                0.23    2023-11-01 [2] RSPM ##  fansi                   1.0.5   2023-10-08 [2] RSPM ##  fastmap                 1.1.1   2023-02-24 [2] RSPM ##  formatR                 1.14    2023-01-17 [2] RSPM ##  fs                      1.6.3   2023-07-20 [2] RSPM ##  futile.logger           1.4.3   2016-07-10 [2] RSPM ##  futile.options          1.0.1   2018-04-20 [2] RSPM ##  generics                0.1.3   2022-07-05 [2] RSPM ##  ggplot2                 3.4.4   2023-10-12 [2] RSPM ##  glue                    1.6.2   2022-02-24 [2] RSPM ##  gtable                  0.3.4   2023-08-21 [2] RSPM ##  htmltools               0.5.6.1 2023-10-06 [2] RSPM ##  htmlwidgets             1.6.2   2023-03-17 [2] RSPM ##  httpuv                  1.6.12  2023-10-23 [2] RSPM ##  httr                    1.4.7   2023-08-15 [2] RSPM ##  jquerylib               0.1.4   2021-04-26 [2] RSPM ##  jsonlite                1.8.7   2023-06-29 [2] RSPM ##  knitr                   1.45    2023-10-30 [2] RSPM ##  lambda.r                1.2.4   2019-09-18 [2] RSPM ##  later                   1.3.1   2023-05-02 [2] RSPM ##  lifecycle               1.0.3   2022-10-07 [2] RSPM ##  lubridate               1.9.3   2023-09-27 [2] RSPM ##  magrittr                2.0.3   2022-03-30 [2] RSPM ##  memoise                 2.0.1   2021-11-26 [2] RSPM ##  mime                    0.12    2021-09-28 [2] RSPM ##  miniUI                  0.1.1.1 2018-05-18 [2] RSPM ##  munsell                 0.5.0   2018-06-12 [2] RSPM ##  pillar                  1.9.0   2023-03-22 [2] RSPM ##  pkgconfig               2.0.3   2019-09-22 [2] RSPM ##  pkgdown                 2.0.7   2022-12-14 [2] RSPM ##  processx                3.8.2   2023-06-30 [2] RSPM ##  promises                1.2.1   2023-08-10 [2] RSPM ##  ps                      1.7.5   2023-04-18 [2] RSPM ##  purrr                   1.0.2   2023-08-10 [2] RSPM ##  R6                      2.5.1   2021-08-19 [2] RSPM ##  ragg                    1.2.6   2023-10-10 [2] RSPM ##  rapiclient              0.1.3   2020-01-17 [2] RSPM ##  Rcollectl             * 1.0.1   2023-04-27 [2] Bioconductor ##  Rcollectlworkflowh5ad * 0.1.0   2023-11-07 [1] local ##  Rcpp                    1.0.11  2023-07-06 [2] RSPM ##  rjsoncons               1.0.0   2022-09-29 [2] RSPM ##  rlang                   1.1.1   2023-04-28 [2] RSPM ##  rmarkdown               2.25    2023-09-18 [2] RSPM ##  rprojroot               2.0.3   2022-04-02 [2] RSPM ##  sass                    0.4.7   2023-07-15 [2] RSPM ##  scales                  1.2.1   2022-08-20 [2] RSPM ##  sessioninfo           * 1.2.2   2021-12-06 [2] RSPM ##  shiny                   1.7.5.1 2023-10-14 [2] RSPM ##  stringi                 1.7.12  2023-01-11 [2] RSPM ##  stringr                 1.5.0   2022-12-02 [2] RSPM ##  systemfonts             1.0.5   2023-10-09 [2] RSPM ##  textshaping             0.3.7   2023-10-09 [2] RSPM ##  tibble                  3.2.1   2023-03-20 [2] RSPM ##  tidyr                   1.3.0   2023-01-24 [2] RSPM ##  tidyselect              1.2.0   2022-10-10 [2] RSPM ##  timechange              0.2.0   2023-01-11 [2] RSPM ##  utf8                    1.2.4   2023-10-22 [2] RSPM ##  vctrs                   0.6.4   2023-10-12 [2] RSPM ##  withr                   2.5.2   2023-10-30 [2] RSPM ##  xfun                    0.41    2023-11-01 [2] RSPM ##  xtable                  1.8-4   2019-04-21 [2] RSPM ##  yaml                    2.3.7   2023-01-23 [2] RSPM ##  ##  [1] /tmp/RtmpXjzgtZ/temp_libpath8b5a2d0172a3 ##  [2] /home/runner/work/_temp/Library ##  [3] /opt/R/4.3.2/lib/R/site-library ##  [4] /opt/R/4.3.2/lib/R/library ##  ## ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"install-packages","dir":"Articles","previous_headings":"","what":"Install packages","title":"Data import from cellxgene","text":"","code":"BiocManager::install(\"cellxgenedp\") BiocManager::install(\"Bioconductor/AnVIL\") BiocManager::install(\"zellkonverter\") BiocManager::install(\"HDF5Array\") BiocManager::install(\"yubocheng/Rcollectlworkflowh5ad\")"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"get-manifests","dir":"Articles","previous_headings":"","what":"Get manifests","title":"Data import from cellxgene","text":"Filter need provided identify h5ad file(s) analysis, manifests file(s) can retrieved.","code":"library(cellxgenedp) library(dplyr) library(AnVIL) library(Rcollectlworkflowh5ad)  manifest_tibble <- get_manifest_tibble() |>   filter(   title == \"Direct Exposure to SARS-CoV-2 and Cigarette Smoke Increases Infection Severity and Alters the Stem Cell-Derived Airway Repair Response\",   filetype == \"H5AD\" )  manifest_tibble ## # A tibble: 1 × 7 ##   dataset_id              collection_id title donor_id cell_count url   filetype ##   <chr>                   <chr>         <chr> <list>        <int> <chr> <chr>    ## 1 077b0429-0f47-48e0-879… cdfb9ead-cb5… Dire… <list>        19361 http… H5AD"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"decide-sample-to-analyze","dir":"Articles","previous_headings":"","what":"Decide sample to analyze","title":"Data import from cellxgene","text":"explore h5ad file, import R SingleCellExperiment object, sample analyze come names(colData(sce)).","code":"library(cellxgenedp) library(dplyr) h5ad_file <- files(db()) |> filter(url == manifest_tibble$url) |> files_download(dry.run = FALSE)  library(zellkonverter) library(HDF5Array) library(SingleCellExperiment) sce <- readH5AD(h5ad_file, use_hdf5 = TRUE, reader = \"R\") names(colData(sce)) ##  [1] \"Genes\"                                    ##  [2] \"Run\"                                      ##  [3] \"X\"                                        ##  [4] \"Y\"                                        ##  [5] \"Virus\"                                    ##  [6] \"Name\"                                     ##  [7] \"Treatment\"                                ##  [8] \"Passch.Basal\"                             ##  [9] \"Passch.Interm..basal.secr.\"               ## [10] \"Passch.Secretory\"                         ## [11] \"Passch.Ciliated\"                          ## [12] \"Passch.FOXN4\"                             ## [13] \"Passch.BrushPNEC\"                         ## [14] \"Passch.Ionocytes\"                         ## [15] \"Passch.SLC16A7\"                           ## [16] \"CellType\"                                 ## [17] \"Basal2\"                                   ## [18] \"DividingCell\"                             ## [19] \"Name2\"                                    ## [20] \"Cluster\"                                  ## [21] \"Name3\"                                    ## [22] \"tissue_ontology_term_id\"                  ## [23] \"assay_ontology_term_id\"                   ## [24] \"disease_ontology_term_id\"                 ## [25] \"development_stage_ontology_term_id\"       ## [26] \"cell_type_ontology_term_id\"               ## [27] \"self_reported_ethnicity_ontology_term_id\" ## [28] \"sex_ontology_term_id\"                     ## [29] \"is_primary_data\"                          ## [30] \"organism_ontology_term_id\"                ## [31] \"donor_id\"                                 ## [32] \"suspension_type\"                          ## [33] \"cell_type\"                                ## [34] \"assay\"                                    ## [35] \"disease\"                                  ## [36] \"organism\"                                 ## [37] \"sex\"                                      ## [38] \"tissue\"                                   ## [39] \"self_reported_ethnicity\"                  ## [40] \"development_stage\""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"import-manifest-file-date-to-table-file","dir":"Articles","previous_headings":"","what":"Import manifest file date to table “file”","title":"Data import from cellxgene","text":"Six variables: manifest_tibble, id, sample, dgCMatrix, core, mem_gb needed import file data table “file”. Id unique id file table. dgCMatrix logical scalar indicate whether assay loaded dgCMatrix (TRUE, default value) HDF5-based matrices HDF5Array package (FALSE), value TRUE suggested h5ad file larger 500 MB. Core number CPU cores required workflow run, default value 3. Mem_gb memory required workflow, default value 60 GB.","code":"sample = \"Name\" avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") ## [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\" id = sprintf(\"%04d\", dim(avtable(\"file\"))[1] + 1) update_file_avtable(manifest_tibble, id, sample, \"true\", 3, 60) ## # A tibble: 1 × 5 ##    page from_row to_row job_id                               status   ##   <int>    <int>  <int> <chr>                                <chr>    ## 1     1        1      1 df654a46-05d7-4c89-b983-59df6e7d0cae Uploaded avtable(\"file\") ## # A tibble: 18 × 11 ##    file_id file_url dataset_title DelayedArray_paramet…¹ knitr_eval mem_gb  core ##    <chr>   <chr>    <chr>         <chr>                  <lgl>       <int> <int> ##  1 0001    https:/… Direct Expos… gs://fc-9bc34f41-efc4… TRUE          120     3 ##  2 0002    https:/… Direct Expos… NA                     TRUE          120     3 ##  3 0003    https:/… Direct Expos… NA                     TRUE          240     3 ##  4 0004    https:/… Direct Expos… NA                     TRUE          240     3 ##  5 0005    https:/… Spleen        gs://fc-9bc34f41-efc4… TRUE          120     3 ##  6 0006    https:/… Spleen        NA                     TRUE          120     3 ##  7 0007    https:/… Spleen        NA                     TRUE          240     3 ##  8 0008    https:/… Spleen        NA                     TRUE          240     3 ##  9 0009    https:/… L4 IT - MTG:… NA                     TRUE          120     3 ## 10 0010    https:/… L4 IT - MTG:… NA                     TRUE          120     3 ## 11 0011    https:/… L4 IT - MTG:… NA                     TRUE          240     3 ## 12 0012    https:/… L4 IT - MTG:… NA                     TRUE          240     3 ## 13 0013    https:/… Direct Expos… NA                     TRUE           60     3 ## 14 0014    https:/… Direct Expos… NA                     TRUE           60     3 ## 15 0015    https:/… Direct Expos… NA                     TRUE           60     3 ## 16 0016    https:/… Direct Expos… NA                     TRUE           60     3 ## 17 0017    https:/… Direct Expos… NA                     TRUE           60     3 ## 18 0018    https:/… Direct Expos… NA                     TRUE           60     3 ## # ℹ abbreviated name: ¹​DelayedArray_parameters_html ## # ℹ 4 more variables: dgCMatrix <lgl>, sample <chr>, cell_count <int>, ## #   workflow_cellxgene_h5ad_html <chr>"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"run-workflow","dir":"Articles","previous_headings":"","what":"Run workflow","title":"Data import from cellxgene","text":"run Rcollectlworkflowh5ad, click Rcollectlworkflowh5ad WORKFLOWS tab, select file “Step 1 Select root entity type:”. INPUTS, select attribute .file_url variable file_url, attribute .knitr_eval variable knitr_eval, attribute .dgCMatrix variable dgCMatrix, attribute .sample variable sample. using attribute .mem_gb .core leave blank variables mem_gb core, default values applied. OUTPUTS, attributes filled “Use defaults”. saving workflow, run selecting h5ad file analyze “Step 2 SELECT DATA”.","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"pull-workflow-output","dir":"Articles","previous_headings":"","what":"Pull workflow output","title":"Data import from cellxgene","text":"Workflow outputs pulled viewed R.","code":"avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") ## [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\" avworkflow_jobs() ## # A tibble: 73 × 9 ##    submissionId            submitter submissionDate      status succeeded failed ##    <chr>                   <chr>     <dttm>              <chr>      <int>  <int> ##  1 35280de1-42d8-492b-aa8… chengyub… 2023-09-01 21:30:54 Done           1      0 ##  2 8ca42a70-d2e9-421f-9f5… chengyub… 2023-09-01 20:35:37 Done           1      0 ##  3 8be18771-f06d-4256-ac1… chengyub… 2023-09-01 19:07:38 Done           1      0 ##  4 c3c147eb-2ff8-4cf0-ba5… chengyub… 2023-09-01 19:06:50 Done           1      0 ##  5 2f0cc8ee-ae53-44e6-a6c… chengyub… 2023-09-01 19:06:02 Done           1      0 ##  6 17efa80e-3ef1-429d-835… chengyub… 2023-09-01 18:50:02 Done           1      0 ##  7 4875b845-d754-4b07-b3b… chengyub… 2023-09-01 18:29:54 Done           0      1 ##  8 316c604d-4ce6-49fc-8b1… chengyub… 2023-07-21 19:56:58 Done           1      0 ##  9 874043e7-a3f5-4a0b-b12… chengyub… 2023-07-21 19:56:35 Done           1      0 ## 10 4c66be7f-2d8a-4e80-917… chengyub… 2023-07-21 19:56:06 Done           1      0 ## # ℹ 63 more rows ## # ℹ 3 more variables: submissionRoot <chr>, namespace <chr>, name <chr> fls <- avworkflow_files() fls ## # A tibble: 16 × 10 ##    file        workflow task  type  path  submissionId workflowId submissionRoot ##    <chr>       <chr>    <chr> <chr> <chr> <chr>        <chr>      <chr>          ##  1 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  2 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  3 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  4 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  5 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  6 AutoBlockS… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  7 cpu_10-1ca… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  8 cpu_12-1ca… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ##  9 cpu_2-1ca6… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 10 cpu_4-1ca6… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 11 cpu_6-1ca6… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 12 cpu_8-1ca6… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 13 workflow_c… Rcollec… NA    outp… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 14 Rcollectl_… Rcollec… Rcol… cont… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 15 stderr      Rcollec… Rcol… cont… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## 16 stdout      Rcollec… Rcol… cont… gs:/… 35280de1-42… e968122f-… gs://fc-9bc34… ## # ℹ 2 more variables: namespace <chr>, name <chr>"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/articles/terra_data_import.html","id":"r-session-information","dir":"Articles","previous_headings":"","what":"R session information","title":"Data import from cellxgene","text":"","code":"## ─ Session info ─────────────────────────────────────────────────────────────────────────────────────────────────────── ##  setting  value ##  version  R version 4.3.2 (2023-10-31) ##  os       Ubuntu 22.04.3 LTS ##  system   x86_64, linux-gnu ##  ui       X11 ##  language en ##  collate  C.UTF-8 ##  ctype    C.UTF-8 ##  tz       UTC ##  date     2023-11-07 ##  pandoc   2.19.2 @ /usr/bin/ (via rmarkdown) ##  ## ─ Packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────── ##  package               * version   date (UTC) lib source ##  abind                 * 1.4-5     2016-07-21 [2] RSPM ##  AnVIL                 * 1.12.4    2023-08-17 [2] Bioconductor ##  basilisk                1.12.1    2023-06-30 [2] Bioconductor ##  basilisk.utils          1.12.1    2023-05-19 [2] Bioconductor ##  Biobase               * 2.60.0    2023-04-25 [2] Bioconductor ##  BiocGenerics          * 0.46.0    2023-04-25 [2] Bioconductor ##  bitops                  1.0-7     2021-04-24 [2] RSPM ##  bslib                   0.5.1     2023-08-11 [2] RSPM ##  cachem                  1.0.8     2023-05-01 [2] RSPM ##  cellxgenedp           * 1.4.1     2023-08-25 [2] Bioconductor ##  cli                     3.6.1     2023-03-23 [2] RSPM ##  colorspace              2.1-0     2023-01-23 [2] RSPM ##  crayon                  1.5.2     2022-09-29 [2] RSPM ##  curl                    5.1.0     2023-10-02 [2] RSPM ##  DelayedArray          * 0.26.7    2023-07-28 [2] Bioconductor ##  desc                    1.4.2     2022-09-08 [2] RSPM ##  digest                  0.6.33    2023-07-07 [2] RSPM ##  dir.expiry              1.8.0     2023-04-25 [2] Bioconductor ##  dplyr                 * 1.1.3     2023-09-03 [2] RSPM ##  DT                      0.30      2023-10-05 [2] RSPM ##  ellipsis                0.3.2     2021-04-29 [2] RSPM ##  evaluate                0.23      2023-11-01 [2] RSPM ##  fansi                   1.0.5     2023-10-08 [2] RSPM ##  fastmap                 1.1.1     2023-02-24 [2] RSPM ##  filelock                1.0.2     2018-10-05 [2] RSPM ##  formatR                 1.14      2023-01-17 [2] RSPM ##  fs                      1.6.3     2023-07-20 [2] RSPM ##  futile.logger           1.4.3     2016-07-10 [2] RSPM ##  futile.options          1.0.1     2018-04-20 [2] RSPM ##  generics                0.1.3     2022-07-05 [2] RSPM ##  GenomeInfoDb          * 1.36.4    2023-10-02 [2] Bioconductor ##  GenomeInfoDbData        1.2.10    2023-11-07 [2] Bioconductor ##  GenomicRanges         * 1.52.1    2023-10-08 [2] Bioconductor ##  ggplot2                 3.4.4     2023-10-12 [2] RSPM ##  glue                    1.6.2     2022-02-24 [2] RSPM ##  gtable                  0.3.4     2023-08-21 [2] RSPM ##  HDF5Array             * 1.28.1    2023-05-01 [2] Bioconductor ##  htmltools               0.5.6.1   2023-10-06 [2] RSPM ##  htmlwidgets             1.6.2     2023-03-17 [2] RSPM ##  httpuv                  1.6.12    2023-10-23 [2] RSPM ##  httr                    1.4.7     2023-08-15 [2] RSPM ##  IRanges               * 2.34.1    2023-06-22 [2] Bioconductor ##  jquerylib               0.1.4     2021-04-26 [2] RSPM ##  jsonlite                1.8.7     2023-06-29 [2] RSPM ##  knitr                   1.45      2023-10-30 [2] RSPM ##  lambda.r                1.2.4     2019-09-18 [2] RSPM ##  later                   1.3.1     2023-05-02 [2] RSPM ##  lattice                 0.21-9    2023-10-01 [4] CRAN (R 4.3.2) ##  lifecycle               1.0.3     2022-10-07 [2] RSPM ##  lubridate               1.9.3     2023-09-27 [2] RSPM ##  magrittr                2.0.3     2022-03-30 [2] RSPM ##  Matrix                * 1.6-1.1   2023-09-18 [4] CRAN (R 4.3.2) ##  MatrixGenerics        * 1.12.3    2023-07-30 [2] Bioconductor ##  matrixStats           * 1.0.0     2023-06-02 [2] RSPM ##  memoise                 2.0.1     2021-11-26 [2] RSPM ##  mime                    0.12      2021-09-28 [2] RSPM ##  miniUI                  0.1.1.1   2018-05-18 [2] RSPM ##  munsell                 0.5.0     2018-06-12 [2] RSPM ##  pillar                  1.9.0     2023-03-22 [2] RSPM ##  pkgconfig               2.0.3     2019-09-22 [2] RSPM ##  pkgdown                 2.0.7     2022-12-14 [2] RSPM ##  png                     0.1-8     2022-11-29 [2] RSPM ##  processx                3.8.2     2023-06-30 [2] RSPM ##  promises                1.2.1     2023-08-10 [2] RSPM ##  ps                      1.7.5     2023-04-18 [2] RSPM ##  purrr                   1.0.2     2023-08-10 [2] RSPM ##  R6                      2.5.1     2021-08-19 [2] RSPM ##  ragg                    1.2.6     2023-10-10 [2] RSPM ##  rapiclient              0.1.3     2020-01-17 [2] RSPM ##  Rcollectl               1.0.1     2023-04-27 [2] Bioconductor ##  Rcollectlworkflowh5ad * 0.1.0     2023-11-07 [1] local ##  Rcpp                    1.0.11    2023-07-06 [2] RSPM ##  RCurl                   1.98-1.13 2023-11-02 [2] RSPM ##  reticulate              1.34.0    2023-10-12 [2] RSPM ##  rhdf5                 * 2.44.0    2023-04-25 [2] Bioconductor ##  rhdf5filters            1.12.1    2023-04-30 [2] Bioconductor ##  Rhdf5lib                1.22.1    2023-09-10 [2] Bioconductor ##  rjsoncons               1.0.0     2022-09-29 [2] RSPM ##  rlang                   1.1.1     2023-04-28 [2] RSPM ##  rmarkdown               2.25      2023-09-18 [2] RSPM ##  rprojroot               2.0.3     2022-04-02 [2] RSPM ##  S4Arrays              * 1.0.6     2023-08-30 [2] Bioconductor ##  S4Vectors             * 0.38.2    2023-09-22 [2] Bioconductor ##  sass                    0.4.7     2023-07-15 [2] RSPM ##  scales                  1.2.1     2022-08-20 [2] RSPM ##  sessioninfo           * 1.2.2     2021-12-06 [2] RSPM ##  shiny                   1.7.5.1   2023-10-14 [2] RSPM ##  SingleCellExperiment  * 1.22.0    2023-04-25 [2] Bioconductor ##  stringi                 1.7.12    2023-01-11 [2] RSPM ##  stringr                 1.5.0     2022-12-02 [2] RSPM ##  SummarizedExperiment  * 1.30.2    2023-06-06 [2] Bioconductor ##  systemfonts             1.0.5     2023-10-09 [2] RSPM ##  textshaping             0.3.7     2023-10-09 [2] RSPM ##  tibble                  3.2.1     2023-03-20 [2] RSPM ##  tidyr                   1.3.0     2023-01-24 [2] RSPM ##  tidyselect              1.2.0     2022-10-10 [2] RSPM ##  timechange              0.2.0     2023-01-11 [2] RSPM ##  utf8                    1.2.4     2023-10-22 [2] RSPM ##  vctrs                   0.6.4     2023-10-12 [2] RSPM ##  withr                   2.5.2     2023-10-30 [2] RSPM ##  xfun                    0.41      2023-11-01 [2] RSPM ##  xtable                  1.8-4     2019-04-21 [2] RSPM ##  XVector                 0.40.0    2023-04-25 [2] Bioconductor ##  yaml                    2.3.7     2023-01-23 [2] RSPM ##  zellkonverter         * 1.10.1    2023-05-23 [2] Bioconductor ##  zlibbioc                1.46.0    2023-04-25 [2] Bioconductor ##  ##  [1] /tmp/RtmpXjzgtZ/temp_libpath8b5a2d0172a3 ##  [2] /home/runner/work/_temp/Library ##  [3] /opt/R/4.3.2/lib/R/site-library ##  [4] /opt/R/4.3.2/lib/R/library ##  ## ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Yubo Cheng. Author, maintainer.","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Cheng Y (2023). Rcollectlworkflowh5ad: Single-Cell Analysis Workflow. R package version 0.1.0.","code":"@Manual{,   title = {Rcollectlworkflowh5ad: Single-Cell Analysis Workflow},   author = {Yubo Cheng},   year = {2023},   note = {R package version 0.1.0}, }"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/index.html","id":"rcollectl-workflow","dir":"","previous_headings":"","what":"Rcollectl Workflow","title":"Single-Cell Analysis Workflow","text":"vignettes package follows single-cell analysis workflow (workflow chapters “Orchestrating Single-Cell Analysis Bioconductor” book) analyze h5ad file cellxgene dataset tracks computing resources usage R package Rcollectl. Two workflows Rcollectlworkflowh5ad workflow_h5ad_DelayedArray_parameters available Dockstore, also set Terra workspace, bioconductor-rpci-yubo/Rcollectlworkflowh5ad. Vignette terra_data_import.Rmd includes R code importing data h5ad file(s) Terra workspace run workflows. performance_summary.Rmd provides performance summary running two workflows, functions summary_result_dataset() summary_result() generate csv files needed vignette.","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/summary_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Parse workflow results — summary_result","title":"Parse workflow results — summary_result","text":"`summary_result_dataset()` returns csv files parsing    workflow results different datasets workflow steps `summary_result()` returns csv files parsing workflow    results different autoBlockSize well cpu","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/summary_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Parse workflow results — summary_result","text":"","code":"summary_result_dataset(inputTribble)  summary_result(submissionId, workflowId = NULL)"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/summary_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Parse workflow results — summary_result","text":"inputTribble submission IDs (workflow IDs) terra job  corresponding name submissionId character(1) submission ID terra job workflowId character(1) workflow ID within submission ID  terra job multiple workflows one submission","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/summary_result.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Parse workflow results — summary_result","text":"","code":"library(AnVIL) #> Loading required package: dplyr #>  #> Attaching package: ‘dplyr’ #> The following objects are masked from ‘package:stats’: #>  #>     filter, lag #> The following objects are masked from ‘package:base’: #>  #>     intersect, setdiff, setequal, union library(Rcollectl) avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") #> [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\"  # inputTribble contains only submission IDs inputTribble <- tribble(   ~name, ~submissionId,   \"dgCMatrix_medium\", \"17efa80e-3ef1-429d-8359-58c7cd653310\",   \"DA_medium\", \"2f0cc8ee-ae53-44e6-a6c0-31e7089f0d42\",   \"dgCMatrix_large\", \"c3c147eb-2ff8-4cf0-ba55-5708fa9c0ae5\",   \"DA_large\", \"8be18771-f06d-4256-ac13-6566a3053f14\" )  # inputTribble contains submission IDs and workflow IDs inputTribble <- tribble(   ~name, ~submissionId, ~workflowId,   \"dgCMatrix_medium\", \"123895c9-6ad1-4258-b3d4-526e057c5cba\", \"923c360d-a30d-4013-b9f3-80058be1b34a\",   \"DA_medium\", \"123895c9-6ad1-4258-b3d4-526e057c5cba\", \"c7d5a05a-a275-411d-9908-3e344200cd4e\",   \"dgCMatrix_large\", \"9385fd75-4cb7-470f-9e07-1979e2c8f193\", \"31c69e74-12d4-40e7-b593-0f59006aca37\",   \"DA_large\", \"9385fd75-4cb7-470f-9e07-1979e2c8f193\", \"1410f324-021a-43f0-90bd-78fbb6a25c50\" )  summary_result_dataset(inputTribble) #> localized 7 workflow files to './123895c9-6ad1-4258-b3d4-526e057c5cba' #> localized 0 workflow files to './123895c9-6ad1-4258-b3d4-526e057c5cba' #> localized 7 workflow files to './9385fd75-4cb7-470f-9e07-1979e2c8f193' #> localized 0 workflow files to './9385fd75-4cb7-470f-9e07-1979e2c8f193' submissionId <- \"8ca42a70-d2e9-421f-9f51-f42601348a82\" summary_result(submissionId) #> localized 5 workflow files to './8ca42a70-d2e9-421f-9f51-f42601348a82'"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/update_data_table.html","id":null,"dir":"Reference","previous_headings":"","what":"Update Terra data table — update_data_table","title":"Update Terra data table — update_data_table","text":"`get_manifest_tibble()` retrieve cellxgene data `update_file_avtable()` imports cellxgene data Terra data    table file","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/update_data_table.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Update Terra data table — update_data_table","text":"","code":"get_manifest_tibble()  update_file_avtable(manifest_tibble, id, sample, dgCMatrix, core, mem_gb)"},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/update_data_table.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Update Terra data table — update_data_table","text":"manifest_tibble character() tibble contains result cellxgene  data id character(1) unique id file table sample character(1) column analyze dgCMatrix logical(1) TRUE, read assay -memory `dgCMatrix` core integer() number cpus mem_gb numeric() memory (GB) allocate running workflow,  default: 60","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/update_data_table.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Update Terra data table — update_data_table","text":"`get_manifest_tibble()` returns tibble","code":""},{"path":"https://yubocheng.github.io/Rcollectlworkflowh5ad/reference/update_data_table.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Update Terra data table — update_data_table","text":"","code":"library(cellxgenedp) #> The interface to CELLxGENE has changed; versions of cellxgenedp prior #> to 1.4.1 / 1.5.2 will cease to work when CELLxGENE removes the previous #> interface. See the section 'API changes' of the 'Discover and download #> datasets...' vignette for important details. manifest_tibble <- get_manifest_tibble() |>   filter(   title == \"Immunophenotyping of COVID-19 and influenza highlights the role      of type I interferons in development of severe COVID-19\",   filetype == \"H5AD\" ) library(AnVIL) avworkspace(\"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\") #> [1] \"bioconductor-rpci-yubo/Rcollectlworkflowh5ad\" manifest_tibble <- get_manifest_tibble() |>   filter(   title == \"Immunophenotyping of COVID-19 and influenza highlights the role      of type I interferons in development of severe COVID-19\",   filetype == \"H5AD\" ) sample = \"Disease.group\" id = sprintf(\"%04d\", dim(avtable(\"file\"))[1] + 1) update_file_avtable(manifest_tibble, id, sample, TRUE, 3, 60) #> pageSize = 0 rows (0 pages) #> # A tibble: 0 × 5 #> # ℹ 5 variables: page <int>, from_row <int>, to_row <int>, job_id <chr>, #> #   status <chr>"}]
